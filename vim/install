mkdir -p ${XDG_CACHE_HOME:-~/.cache}/vim

# Move old configs out of the way so they don't interfere
if [ -L ~/.vimrc ] || [ -e ~/.vimrc ]; then
    mv ~/.vimrc ~/.vimrc.old
fi
if [ -L ~/.vim ] || [ -e ~/.vim ]; then
    mv ~/.vim ~/.vim.old
fi

link . ~/.config/vim

if [ -e ~/.viminfo ] && [ ! -e ~/.config/vim/viminfo ]; then
    # Copy existing data to new location
    cp ~/.viminfo ~/.config/vim/viminfo
fi

# Bundle setup
if [ ! -e ~/.config/vim/bundle/vundle ]; then
    git clone git://github.com/gmarik/vundle ~/.config/vim/bundle/vundle
fi

if [ -e vimrc -a -e ~/.config/vim/bundle/vundle ]; then
    vim -u ~/.config/vim/vimrc +BundleInstall +qall
fi

set_launchd VIMINIT 'let $MYVIMRC = "~/.config/vim/vimrc" | source $MYVIMRC'
