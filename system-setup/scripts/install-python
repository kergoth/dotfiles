#!/bin/sh

export PYENV_ROOT="${1:-${PYENV_ROOT:-${XDG_DATA_HOME:-$HOME/.local/share}/pyenv}}"
PATH="$(dirname "$0"):$PYENV_ROOT/bin:$HOME/.local/bin:$PATH"

export CFLAGS="-O2 -fomit-frame-pointer"
export PYTHON_CONFIGURE_OPTS="${PYTHON_CONFIGURE_OPTS-${CONFIGURE_OPTS---with-lto --enable-optimizations}}"

pyenv-installer
eval "$(pyenv init -)"
eval "$(pyenv virtualenv-init -)"
pyenv install 3.6.5
pyenv install 2.7.14
pyenv global 2.7.14 3.6.5

# At this point python is python2, and python2 and python3 work as expected,
# but python tools run with these pythons will have that python install first
# in the PATH. In the case of python3, this means in that process, 'python'
# will now correspond to python3, which will not do (see bitbake).
rm -f "$(dirname "$(pyenv which python3)")"/python
