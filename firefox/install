case "$OSTYPE" in
    darwin*)
        ff_profileroot="$INSTALL_DEST/Library/Application Support/Firefox/Profiles"
        ;;
    WSL)
        if [ "$INSTALL_DEST" = "$USERPROFILE" ]; then
            ff_profileroot="$USERPROFILE/AppData/Roaming/Mozilla/Firefox/Profiles"
        else
            ff_profileroot="$INSTALL_DEST/.mozilla/firefox"
        fi
        ;;
    *)
        ff_profileroot="$INSTALL_DEST/.mozilla/firefox"
        ;;
esac

if [ -d "$ff_profileroot" ]; then
    for places in "$ff_profileroot/"*/places.sqlite; do
        profiledir="${places%/*}"
        if [ -d "$profiledir" ]; then
            link user-overrides.js "$profiledir/user-overrides.js"
            if ! [ -e "$profiledir/updater.sh" ]; then
                cp -f updater.sh "$profiledir/updater.sh"
            fi
            if ! [ -e "$profiledir/user.js" ]; then
                ( cd "$profiledir" && bash ./updater.sh; )
            fi
        fi
    done
fi

link addons-script-config.toml "$XDG_CONFIG_HOME/firefox-addons/config.toml"

# vim: set ft=sh :
