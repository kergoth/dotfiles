{{ if eq .chezmoi.os "darwin" -}}
#!/usr/bin/env bash

set -euo pipefail

if [ -n "${ZED_PREFER_PREVIEW:-}" ]; then
    identifier=dev.zed.Zed-Preview
    fallback=dev.zed.Zed
else
    identifier=dev.zed.Zed
    fallback=dev.zed.Zed-Preview
fi

if [ -n "${__CFBundleIdentifier}" ]; then
    case "${__CFBundleIdentifier}" in
        dev.zed*)
            identifier="${__CFBundleIdentifier}"
            ;;
    esac
fi

app=$(mdfind "kMDItemCFBundleIdentifier == '$identifier'" | head -n 1)
if [ -z "$app" ]; then
    app=$(mdfind "kMDItemCFBundleIdentifier == '$fallback'" | head -n 1)
fi

if [ -n "$app" ]; then
    exec "$app/Contents/MacOS/cli" "$@"
else
    echo "Error: Zed application not found" >&2
    exit 1
fi
{{- end }}
