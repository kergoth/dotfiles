#!/bin/sh

excluded="bin|bootstrap|oh-my-zsh|config|TODO|BUGS"
if echo $OSTYPE | grep "^darwin"; then
    # We don't want XQuartz trying to spawn sscrotwm
    excluded="$excluded|xinitrc"
fi

bindir=$(readlink -f $(dirname $0) 2>/dev/null)
if [ $? -ne 0 ]; then
    bindir=$(cd $(dirname $0) && pwd)
fi
dotfiles=$(dirname $bindir)

alias relpath=$bindir/relpath

relative_from_home=$(relpath $HOME $dotfiles)
cd $dotfiles

echo $relative_from_home/bin $HOME/bin
ls | grep -Ev "^($excluded)$" | while read path; do
    echo $relative_from_home/$path $HOME/.$path
done

if test -e config; then
    mkdir -p $HOME/.config
    relative_path=$(relpath $HOME/.config $dotfiles/config)
    ls config | cut -d/ -f2- | while read path; do
        echo $relative_path $HOME/.config/$path
    done
fi

if test "$(uname -s)" = "Darwin"; then
    relative_path=$(relpath $HOME/Library/Application\ Support $dotfiles/config/sublime-text-2)
    echo $relative_path $HOME/Library/Application\ Support/Sublime\ Text\ 2
fi
