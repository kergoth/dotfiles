#!/bin/sh

link_dotfile () {
    dotfile=$1
    dotfile_dest=$2
    dotfile_dirname="${dotfile%/*}"
    if [ -z "$dotfile_dest" ]; then
        if [ "$dotfile_dirname" != "$dotfile" ]; then
            dotfile_dest="$HOME/.$dotfile_dirname/${dotfile##*/}"
        else
            dotfile_dest="$HOME/.$dotfile"
        fi
    fi
    destdir="${dotfile_dest%/*}"
    dotfile_relpath="$(relpath "$destdir" "$PWD/$dotfile")"
    dotfile_resolved="${dotfile_dest%/*}/$dotfile_relpath"
    if [ ! -e "$dotfile_resolved" ]; then
        echo >&2 "Error: $dotfile_resolved does not exist"
    fi
    printf "$dotfile_relpath\t$dotfile_dest\n"
}

link_dotfiles () {
    for dotfile; do
        if [ ! -e "$dotfile" ]; then
            continue
        fi

        link_dotfile "$dotfile"
    done
}

cd ${0%/*}/..

link_dotfile zshenv
link_dotfile boom
link_dotfile Xresources
link_dotfile gemrc
link_dotfile hgrc
link_dotfile netrc
link_dotfile lmwsaction.ini
link_dotfiles ssh/*
link_dotfiles config/*

if test "$(uname -s)" = "Darwin"; then
    stpath="$HOME/Library/Application Support/Sublime Text 2"
else
    stpath="$HOME/.config/sublime-text-2"
fi
for path in config/sublime-text-2/Packages/*; do
    link_dotfile "$path" "$stpath/${path##*/}"
done

exit 0
