#!/usr/bin/env python

import kergsvk, sys, os, addons, re

try:
    path = sys.argv[1]
except IndexError:
    path = '.'

fileslist = []
tocfileslist = []
for toc in kergsvk.gettocfiles(path):
    addondir = os.path.dirname(toc)
    def findluaorxml(arg, dirname, fnames):
        for file in fnames:
            if file.endswith('.lua') or file.endswith('.xml'):
                arg.append(os.path.join(dirname, file))
                # print("actual: %s" % os.path.join(dirname, file))
    os.path.walk(addondir, findluaorxml, fileslist)

    a = addons.Addon(toc)
    if a.isvalid():
        for line in a.lines:
            line = line.strip()
            # if len(line) > 0 and re.match(line, '^[a-zA-Z]'):
            if len(line) > 0 and re.match('^[A-Za-z]', line):
                filename = os.path.join(addondir, line.replace('\\', '/'))
                tocfileslist.append(filename)

print("Files mentioned in .toc but not found:")
print("\n".join([f for f in tocfileslist if not f in fileslist]))
print("Files found but not mentioned in .toc:")
print("\n".join([f for f in fileslist if not f in tocfileslist and not f.endswith('Bindings.xml')]))

#def gettocfiles(path):
#    def findtoc(arg, dirname, fnames):
#        for file in fnames:
#            if file.endswith('.toc'):
#                arg.append(os.path.join(dirname, file))
#
#    toclist = []
#    os.path.walk(path, findtoc, toclist)
#    return toclist
