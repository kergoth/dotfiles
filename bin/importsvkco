#!/bin/sh

#ver="svn`date +%Y%m%d`"
ver="svn`date +%Y%m%d.%H%M`"
set -e

TEMP=`getopt -n foo.sh -- $0 "$@"`
eval set -- "$TEMP"

shift
for arg; do
    base="`basename \"$arg\"`"
    if [ -z "$base" ]; then
        echo >&2 "ERROR: base is empty."
        exit 1
    fi
    rm -rf "$base"
done
svkco "$@"

for arg; do
    addon="`svk ls \"$arg/\"|grep '\.toc$'|head -n 1|sed -e's,.toc$,,'`"
    base="`basename \"$arg\"`"
    rm -f "${addon}-${base}.zip"
    zip -r "${addon}-${base}.zip" "$base"
    wow_addon -V "$ver" "${addon}-${base}.zip"
    shift
done
