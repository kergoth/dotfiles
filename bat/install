case "$OSTYPE" in
    darwin*)
        cfgpath=~/Library/Preferences
        ;;
    *)
        cfgpath=$XDG_CONFIG_HOME
        ;;
esac

if [ -e $cfgpath/bat/syntax ] && [ ! -e $cfgpath/bat/syntaxes ]; then
    mv $cfgpath/bat/syntax $cfgpath/bat/syntaxes
fi

if [ -h $cfgpath/bat ]; then
    rm -f $cfgpath/bat
fi

mkdir -p $cfgpath/bat/syntaxes
for i in syntax/*; do
    if [ -e "$i" ]; then
        ln -sf $PWD/$i/*.sublime-syntax $cfgpath/bat/syntaxes/
    fi
done

mkdir -p $cfgpath/bat/themes
for i in themes/*.tmTheme; do
    if [ -e "$i" ]; then
        ln -sf $PWD/$i $cfgpath/bat/$i
    fi
done
ln -sf base16-tomorrow-night.tmTheme $cfgpath/bat/themes/Default.tmTheme

if [ ! -e $cfgpath/bat/syntaxes/Packages ]; then
    git clone https://github.com/sublimehq/Packages $cfgpath/bat/syntaxes/Packages
fi

if [ ! -e $cfgpath/bat/syntaxes/Elixir ]; then
    git clone https://github.com/princemaple/elixir-sublime-syntax $cfgpath/bat/syntaxes/Elixir
fi

if which bat >/dev/null 2>&1; then
    bat cache -i
fi
